<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!--   <link rel="stylesheet" type="text/css" href="styles.css"> -->
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
</head>

<body>
<nav>
  <button id="button">
    compile
  </button>
</nav>
<div class = 'top'>
  <textarea id= "REEE"></textarea>
</div>
<div class = 'bottom'>
  <p id="message"></p>
  <div class = 'threejs'>
    <!-- <p>filler</p> -->
  </div>
</div>


<script>
var client = "db6c4e08d127f46b3ccffdbb55ba7df3"
var secret = "53f2a59444066477d9d17a7e773b4899b4ea7592dfc9dad62907ead3834298a"

$(document).ready(function(){
    $("button").click(function(){
      var code = document.getElementById("REEE").value

      var options = {
        script: code,
        language: "c",
        versionIndex:'0',
        clientId:client,
        clientSecret:secret
      }

      $.ajax({
          url: 'https://cors-anywhere.herokuapp.com/https://api.jdoodle.com/v1/execute',
          type: 'post',
          data: JSON.stringify(options),
          headers: {
            'Content-Type': 'application/json',
            'charset' : 'UTF-8'
          },
          success: function (data) {
            console.log(data);
            var noImport = "No such file or directory"
            if(data["output"].includes(noImport) || data["output"] == ""){
              document.getElementById("message").innerHTML = "pass"
            }
            else{
              document.getElementById("message").innerHTML = data["output"]
            }

            var lines = code.split("/\r?\n/");

            for (var line in lines){
              if(line.replace(/\s/g, "") == ""){
                continue
              }
              var options = {
                src: code
              }
              console.log(JSON.stringify(options))
              $.ajax({
                url: "https://cors-anywhere.herokuapp.com/http://54945da7.ngrok.io/interpret",
                type: 'POST',
                data: JSON.stringify(options),
                headers:{
                  'Content-Type':'application/json'
                },
                success: function(data) {
                  data = JSON.parse(data)

                  var importantwords = {};
                  var params = {}
                  for (var x in data){
                    if(data[x]["params"].length != 0){
                      importantwords[x] = data[x]
                      params[x] = data[x]["params"]
                    }
                  }
                  console.log(params)
                  var keys = Object.keys(params)
                  console.log(keys)
                  var real_params = []
                  for (var x in params){
                    real_params.push(params[x])
                  }

                  var function_info = {
                    functions: JSON.stringify(keys),
                    params: JSON.stringify(real_params)
                  }
                  console.log(JSON.stringify(function_info))


                  $.ajax({
                    url: "https://cors-anywhere.herokuapp.com/http://1aee12a1.ngrok.io/sentence",
                    type: 'POST',
                    data: JSON.stringify(function_info),
                    headers:{
                      'Content-Type':'application/json'
                    },
                    success: function(data) {
                      console.log(data)
                      data = JSON.parse(data)
                    }
                  });
//make some post request to me with important words function and params
                }
              });
            }

          }
      });
    });
});

function httpPost(url, code){

}
</script>

  <script src="js/three.min.js"></script>
  <script src="js/OrbitControls.js"></script>

  <script>

    // Set up the scene, camera, and renderer as global variables.
    var scene, camera, renderer;

    init();
    animate();

    // Sets up the scene.
    function init() {

      // Create the scene and set the scene size.
      scene = new THREE.Scene();
      var WIDTH = window.innerWidth,
          HEIGHT = window.innerHeight;

      // Create a renderer and add it to the DOM.
      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(WIDTH, HEIGHT);
      document.getElementsByClassName('threejs')[0].appendChild(renderer.domElement);

      // Create a camera, zoom it out from the model a bit, and add it to the scene.
      camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 20000);
      camera.position.set(0,6,0);
      scene.add(camera);

      // Create an event listener that resizes the renderer with the browser window.
      window.addEventListener('resize', function() {
        var WIDTH = window.innerWidth,
            HEIGHT = window.innerHeight;
        renderer.setSize(WIDTH, HEIGHT);
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();
      });

      // Set the background color of the scene.
      renderer.setClearColorHex(0x333F47, 1);

      // Create a light, set its position, and add it to the scene.
      var light = new THREE.PointLight(0xffffff);
      light.position.set(-100,200,100);
      scene.add(light);

      // Load in the mesh and add it to the scene.
      var loader = new THREE.JSONLoader();
      loader.load( "models/treehouse_logo.js", function(geometry){
        var material = new THREE.MeshLambertMaterial({color: 0x55B663});
        mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);
      });

      // Add OrbitControls so that we can pan around with the mouse.
      controls = new THREE.OrbitControls(camera, renderer.domElement);

    }


    // Renders the scene and updates the render as needed.
    function animate() {

      // Read more about requestAnimationFrame at http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/
      requestAnimationFrame(animate);

      // Render the scene.
      renderer.render(scene, camera);
      controls.update();

    }

  </script>
  <link rel="stylesheet" type="text/css" href="styles.css">
</body>
</html>
